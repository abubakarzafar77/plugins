jQuery(document).ready(function($) {
    jQuery('.white_section_post').remove();
//    QUIZ

    jQuery("#current_value").val(1);
    var max_value_of_q = jQuery("#max_value").val();
    jQuery('input[value=Forrige]').hide();
    if (max_value_of_q === jQuery("#current_value").val())
    {
        jQuery('input[value=Neste]').hide();
        jQuery('input[value=Forrige]').hide();
        jQuery("#pfbc .submit_button").show();
        jQuery("#pfbc .submit_button").css("float" , "none");
        
    }
    else {
        jQuery("#pfbc .submit_button").hide();
    }

//QUIZ END



    $('form.answer-survey label.control-label > span.required').each(function() {
        var next = $(this).parent().next();
        $('input[type="checkbox"]', next).each(function() {
            $(this).prop('required', true);
        });
    });

    var currentPosition = $('form.answer-survey').position()
    $('form.answer-survey input[type="submit"]').prop('disabled', false);

    $('form.answer-survey').each(function() {
        $(this).validate({
            errorPlacement: function(error, element) {
                var scope = element.closest($('.control-group'));
                var firstChild = $('> label', scope);
                error.insertBefore(firstChild);
            },
            submitHandler: function(form) {
                var overlay = $('.overlay', form);
                overlay.show();
                var survey_id = jQuery("input[name='survey_id']").val();
                var survey_id2 = jQuery("input[name='survey_id2']").val();
                if (survey_id != survey_id2 && (survey_id2 == parseInt(survey_id2, 10)))
                {
                    survey_id = jQuery("input[name='survey_id2']").val();
                }

                $.post(wwm_awesome_surveys.ajaxurl, $(form).serializeArray(), function(data) {
                    if (null == data) {
                        $(form).empty().append('<p class="error">An unknown error occured (data object is null)</p>');
                        return null;
                    }
//                    msg = ('undefined' != typeof data.data.thank_you) ? data.data.thank_you : '<span class="error">' + data.data + '</span>';
                    msg = ('undefined' != typeof data.data.thank_you) ? "<p>Vennligst vent for resultatet ....</p>" : '<span class="error">' + data.data + '</span>';
                    $(form).empty().append('<p>' + msg + '</p>');
                    if (data) {
                        setTimeout(function() {
//                            window.location = 'http://' + window.location.hostname + '/result_page?post_id=' + survey_id+'&restart='+window.location.href;
                            window.location = 'http://' + window.location.hostname + '/result_page?post_id=' + survey_id;
                        }, 100);
                    }
//                   q comment
//                    if (null != data.data.url) {
//                        window.location = data.data.url;
//                    }
                }, 'json').fail(function(xhr) {
                    $(form).empty().append('<p class="error">There was an error. The error status code is: ' + xhr.status + ' The error message is: ' + xhr.statusText + '</p>');
                }).always(function() {
                    window.scroll(currentPosition.left, -currentPosition.top)
                    overlay.hide();
                });
            }
        });
    });
    $('form.answer-survey textarea[data-rule-maxlength][data-add_countdown]').each(function() {
        maxLength = $(this).data('rule-maxlength')
        if ('undefined' != typeof maxLength) {
            $('<div class="countdown"><span class="remaining-chars">' + maxLength + '</span> ' + wwm_awesome_surveys.countDownMessage + '</div>').insertAfter($(this))
        }
    }).keyup(function() {
        maxLength = $(this).data('rule-maxlength')
        curLength = $(this).val().length
        remaining = maxLength - curLength
        $('.remaining-chars', $(this).parent()).empty().append(remaining)
    });

});

function nextcall() {
    setTimeout(function() {
        var next_val = jQuery("#current_value").val();
        var alert_val = parseInt(next_val) - 1;
        if (!(jQuery("input[name='question[" + alert_val + "]']:checked").val()))
        {
            jQuery(".error").remove();
            jQuery("#question_" + alert_val).prepend("<label id='question[" + alert_val + "]-error' class='error' for='question[" + alert_val + "]'>Dette feltet er obligatorisk.</label>");
//            jQuery("<label style='color:red;' id='error_paragraph' class='error'>Please select atleast one</label>").insertAfter("#question_" + alert_val);
        }
        else {
            var next_val = jQuery("#current_value").val();
            var max_val = jQuery("#max_value").val();
            var alert_val = parseInt(next_val) + 1;
            if (alert_val == max_val)
            {
                jQuery('input[value=Neste]').hide();
                jQuery('input[value=Forrige]').show();
                jQuery("#pfbc .submit_button").show();
//        jQuery('input[value=Submit Response]').show();
            }
            else
            {
                jQuery('input[value=Neste]').show();
                jQuery('input[value=Forrige]').show();
                jQuery("#pfbc .submit_button").hide();
//        jQuery('input[value=Submit Response]').hide();

            }
            var prev_val = next_val - 1;
            jQuery("#question_" + next_val).css('display', 'block');
            jQuery("#question_" + prev_val).css('display', 'none');
            jQuery("#current_value").val(function(i, oldval) {
                return parseInt(oldval, 10) + 1;
            });
            jQuery("#error_paragraph").remove();
        }
    }
    , 1000);

}
function prevcall() {
    setTimeout(function() {

        var next_val = jQuery("#current_value").val();
        var max_val = jQuery("#max_value").val();
        var alert_val = parseInt(next_val) - 2;
        jQuery(".error").remove();
        if (alert_val == 0)
        {
//            hide previous
            jQuery('input[value=Forrige]').hide();
            jQuery('input[value=Neste]').show();
            jQuery("#pfbc .submit_button").hide();
        }
        else
        {
            jQuery('input[value=Forrige]').show();
            jQuery('input[value=Neste]').show();
            jQuery("#pfbc .submit_button").hide();
        }
        var prev_val = next_val - 2;
        var next_val = next_val - 1;
        jQuery("#question_" + next_val).css('display', 'none');
        jQuery("#question_" + prev_val).css('display', 'block');
        jQuery("#current_value").val(function(i, oldval) {
            return parseInt(oldval, 10) - 1;
        });
    }, 1000);
}